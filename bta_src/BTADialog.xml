<?xml version="1.0"?>
<dialog title="Generate a Texture Atlas">
	
	<flash src="$CONFIGDIRCommands\bta_src\BTAlogo.swf" width="610" height="72"></flash>
	<!-- <separator/> -->

	<hbox>
		<label value=" " />
		<label value="Texture Atlas Export" id="stuff" control="radioGroup" />
	</hbox>

	<script>

		var save = [];
		
		if (FLfile.exists(fl.configURI + "Commands/bta_src/saveBTA.txt"))
			save = FLfile.read(fl.configURI + "Commands/bta_src/saveBTA.txt").split("\n");

		function myThing()
		{
			fl.trace(fl.xmlui.get("imgDims"));
			var isVisible = fl.xmlui.getVisible("DFormat"); 
			fl.trace(isVisible);
			
			fl.trace(fl.xmlui.get("algorithm"));
			fl.xmlui.set("algorithm", "MaxRects");


			fl.trace(save);
		}

		function addParams()
		{
			fl.runScript(fl.configURI + "Commands/bta_src/save.scr", "xmlSaveStuff");
		}


		function algorithmSet()
		{
			var value = "MaxRects";

			if (save[7] != null)
				value = save[7];

			fl.xmlui.set("algorithm", value);

			algorithmSel();
		}

		fl.runScript(fl.configURI + "Commands/bta_src/save.scr", "theme");

		function imgFormatSet()
		{
			var value = "PNG 32 bits";

			if (save[8] != null)
				value = save[8];

			fl.xmlui.set("imgFormat", value);
		}


		function algorithmSel()
		{
			var value = fl.xmlui.get("algorithm");

			fl.xmlui.setEnabled("Rotate", value == "MaxRects");
		}
		function dFormatSel()
		{
			var value = fl.xmlui.get("DFormat");

			
			fl.xmlui.setEnabled("Rotate", value == "raster");
			fl.xmlui.setEnabled("imgFormat", value == "raster");
			fl.xmlui.setEnabled("imgDims", value == "raster");
			fl.xmlui.setEnabled("ResSld", value == "raster");
			fl.xmlui.setEnabled("ShpPad", value == "raster");
			fl.xmlui.setEnabled("BrdPad", value == "raster");
			fl.xmlui.setEnabled("OptDimens", value == "raster");
			fl.xmlui.setEnabled("FlatSke", value == "raster");
			fl.xmlui.setEnabled("algorithm", value == "raster");
			fl.xmlui.setEnabled("cusWid", value == "raster");
			fl.xmlui.setEnabled("cusHei", value == "raster");
		}
		function accept()
		{
			var saveBox = fl.xmlui.get("saveBox");

			if (!FLfile.exists(FLfile.platformPathToURI(saveBox)))
			{
				saveAndClose();
				return;
			}
			
			var check = fl.xmlPanel(fl.configURI + 'Commands/bta_src/BTAConfirm.xml');

			if (check.dismiss == "accept")
				saveAndClose();
		}

		function saveAndClose()
		{

			var save = [];
			var saveArray = fl.xmlui.get("saveBox").split("\\");
			saveArray.pop();
			var savePath = saveArray.join("\\");
			save[0] = savePath;
			save[1] = fl.xmlui.get("ShpPad");
			save[2] = fl.xmlui.get("BrdPad");
			save[3] = fl.xmlui.get("ResSld");
			save[4] = fl.xmlui.get("OptDimens");
			save[5] = fl.xmlui.get("OptAn");
			save[6] = fl.xmlui.get("FlatSke");
			save[7] = fl.xmlui.get("algorithm");
			save[8] = fl.xmlui.get("imgFormat");

			fl.trace(save.join("\n"));
			fl.trace(fl.configURI + "Commands/bta_src/saveBTA.txt");

			FLfile.write(fl.configURI + "Commands/bta_src/saveBTA.txt", save.join("\n"));
			fl.xmlui.accept();
		}
		
	</script>

	<radiogroup id="radioGroup" groupbox="true" label="Texture Atlas Output">

		<grid>

			<columns>
				<column/>
				<column/>
				
			</columns>
			<rows>
				<row>
					<grid>
						<columns>
							<column/>
							<column/>
						</columns>
						<rows>
							<row>
								<label value="Image dimensions:" align="right"/>
								<hbox>
								<menulist id="imgDims" oncreate="fl.xmlui.setEnabled('imgDims', false);">
									<menupop>
										<menuitem label="Automatic Size" value="auto"/>
										<menuitem label="64x64" value="64"/>
									<menuitem label="128x128" value="128"/>
									<menuitem label="256x256" value="256"/>
									<menuitem label="512x512" value="512"/>
									<menuitem label="1024x1024" value="1024"/>
									<menuitem label="128x128" value="128"/>
									<menuitem label="256x256" value="256"/>
									<menuitem label="512x512" value="512"/>
									</menupop>
								</menulist>
								<vbox>
									<hbox>
										<label value= " "/>
										<checkbox id="OptDimens" checked="true" oncreate="fl.xmlui.setEnabled('OptDimens', false);" label="Optimize dimensions" />
									</hbox>
									<label value= " "/>
								</vbox>
								</hbox>
							</row>
							<row>
								<label value="Width:" align="right"/>
								<textbox id="cusWid" label="Your mom" maxlength="4" value="auto" oncreate="fl.xmlui.setEnabled('cusWid', false);" width="50" />

		
							</row>
							<row>
								<label value="Height:" align="right"/>
								<textbox id="cusHei" label="Your mom" maxlength="4" value="auto" oncreate="fl.xmlui.setEnabled('cusHei', false);" width="50" />
		
							</row>
							<row align="right">
								<label value="Image Format:" align="right"/>
								<menulist id="imgFormat" oncreate="imgFormatSet()">
									<menupop>
										<menuitem label="PNG 32 bits"/>
										<menuitem label="PNG 8 bits"/>
									</menupop>
								</menulist>
							</row>
							
							<!-- <row><label value=" " /></row> -->
							<row align="right">
								<label value="Resolution:" align="right"/>
								<textbox id="ResSld" label="Your mom" maxlength="3" value="$RES" width="50" />
							</row>
							<row>
								<!-- <label value="(rasterized only)" align="right"/> -->
		
							</row>
							<row><label value=" " /></row>
						</rows>
					</grid>
					
					<grid>
		
						<columns>
							<column/>
							<column/>
						</columns>
						<rows>
							<row align="right">
								<label value="Algorithm: " control="xScale" align="right" />
								<menulist id="algorithm" oncreate="algorithmSet()" onchange="algorithmSel()">
										<menupop>
											<menuitem label="Basic"/>
											<menuitem label="MaxRects"/>
										</menupop>
								</menulist>
							</row>
							<row align="right">
								<label value="Data Format: " control="DFormat" align="right" />
								<menulist id="DFormat" oncreate="fl.xmlui.setEnabled('DFormat', false);" onchange="dFormatSel();">
										<menupop>

											
											<menuitem label="Rasterised JSON" value="raster"/>
											<menuitem id="mesh" label="Vectorised JSON" value="mesh"/>
										</menupop>
								</menulist>
							</row>
							<row align="right">
								<label value=""/>
								<checkbox id="Rotate" checked="true" label="Rotate" />
							</row>
							<row align="right">
								<label value=""/>
								<label value=""/>
							</row>
							<row align="center">
								<label value="Shape padding: " control="ShpPad" align="right"/>
								<textbox id="ShpPad" maxlength="3" value="$SHP" width="50" />
							</row>
							<row align="center">
								<label value="Border padding: " control="BrdPad" align="right"/>
								<textbox id="BrdPad" maxlength="3" value="$BRD" width="50" />
							</row>
						</rows>
					</grid>
				</row>
			</rows>
			

		</grid>


		<spacer/>
		<spacer/>
		<separator/>
		<spacer/>
		<spacer/>
		<grid>
			<columns>
				<column/>
				<column/>
				<column/>
				<column/>
			</columns>

			<rows>
				<row>
					<vbox>
						<checkbox id="OptAn" checked="$OPTAN" label="Optimize Animation.json file" />

						<checkbox id="FlatSke" checked="$FLAT" label="Flatten skewed objects to bitmap" />
					</vbox>
					<label value=" "/>
					<label value=" "/>
					<button align="center" label="Additional Params" oncommand="addParams();"/>
				</row>
			</rows>
		</grid>

		<spacer/>
		<spacer/>
		<spacer/>

	</radiogroup>
	
	<spacer/>

	<spacer/>

	<grid>
		<columns>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
			<column/>
		</columns>
		<rows>
			<row>
				<label value="Export Path" control="saveBox" />
			</row>
			<row>
				<choosefile size="40" value="$FILEURI" required="true" pathtype="absolute" id="saveBox" type="save" />
				<spacer/>
				<label value=" "/>
				<label value=" "/>
				<label value=" "/>
				<label value=" "/>
				<label value=" "/>
				<label value=" "/>
				<label value=" "/>
				<label value=" "/>
				<label value=" "/>
				<label value=" "/>
				<label value=" "/>
				<label value=" "/>
				<label value=" "/>
				<label value=" "/>
				<spacer/>
				<grid>
					<columns>
						<column/>
						<column/>
						<column/>
					</columns>
					<rows>
						<row>
							<button label="Export" oncommand="accept()" width="$BWI"/>
							<label value="" />
							<button label="Cancel" oncommand="fl.xmlui.cancel()" width="$BWI"/>
						</row>
					</rows>
				</grid>
			</row>
		</rows>
	</grid>
	
</dialog>